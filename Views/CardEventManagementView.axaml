<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:QuanLyXe03.ViewModels"
             xmlns:models="using:QuanLyXe03.Models"
             mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="800"
             x:Class="QuanLyXe03.Views.CardEventManagementView"
             x:DataType="vm:CardEventManagementViewModel" 
             x:CompileBindings="True">
    <Grid RowDefinitions="Auto,Auto,Auto,*" Margin="15">
        <Grid Grid.Row="0" ColumnDefinitions="2*,1*,1*,*" Margin="0,0,0,10">
            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                <TextBlock Text="Từ khóa:" FontSize="13" Margin="0,0,0,5"/>
                <TextBox Text="{Binding SearchText}" Watermark="Số thẻ, biển số, tên khách hàng..." Height="35"/>
            </StackPanel>
            <StackPanel Grid.Column="1" Margin="0,0,10,0">
                <TextBlock Text="Từ ngày:" FontSize="13" Margin="0,0,0,5"/>
                <DatePicker SelectedDate="{Binding FromDate}" Height="35"/>
            </StackPanel>
            <StackPanel Grid.Column="2" Margin="0,0,10,0">
                <TextBlock Text="Đến ngày:" FontSize="13" Margin="0,0,0,5"/>
                <DatePicker SelectedDate="{Binding ToDate}" Height="35"/>
            </StackPanel>
            <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Bottom" Spacing="10">
                <Button Content="Tìm kiếm" Command="{Binding LoadCardEventsCommand}" 
                        IsEnabled="{Binding !IsLoading}" Background="#2980b9" Foreground="White" Width="100" Height="35"/>
                <Button Content="Reset" Command="{Binding ResetFiltersCommand}" 
                        Background="#2c3e50" Foreground="White" Width="100" Height="35"/>
            </StackPanel>
        </Grid>

        <Grid Grid.Row="1" ColumnDefinitions="*,Auto" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal" Spacing="15" VerticalAlignment="Center">
                <TextBlock Text="{Binding TotalCount, StringFormat='Tổng số: {0} bản ghi'}" 
                           FontWeight="Bold" FontSize="14" Foreground="#7da7d1"/>
                <ProgressBar IsIndeterminate="True" IsVisible="{Binding IsLoading}" 
                             Width="120" Height="8" VerticalAlignment="Center"/>
            </StackPanel>
            <Button Grid.Column="1" Content="Xuất Excel" Command="{Binding ExportToExcelCommand}" 
                    Background="#27ae60" Foreground="White" Padding="15,8"/>
        </Grid>

        <Grid Grid.Row="2" ColumnDefinitions="*,Auto,Auto,Auto,*" Margin="0,5,0,15" Height="40">
            <Button Grid.Column="1" Content="‹ Trang trước" Command="{Binding PreviousPageCommand}"
                    Width="110" Height="35" Background="#6c757d" Foreground="White"/>
            <TextBlock Grid.Column="2" VerticalAlignment="Center" Margin="15,0"
                       FontSize="14" FontWeight="Bold" Foreground="#333">
                <Run Text="Trang "/>
                <Run Text="{Binding CurrentPage}" Foreground="#7da7d1"/>
                <Run Text=" / "/>
                <Run Text="{Binding TotalPages}" Foreground="#007bff"/>
            </TextBlock>
            <Button Grid.Column="3" Content="Trang sau ›" Command="{Binding NextPageCommand}"
                    Width="110" Height="35" Background="#6c757d" Foreground="White"/>
        </Grid>

        <Border Grid.Row="3" BorderBrush="#ddd" BorderThickness="1" CornerRadius="6"
                Background="White" BoxShadow="0 4 20 0 #20000000">

            <DataGrid ItemsSource="{Binding CardEvents}"
                      x:DataType="vm:CardEventManagementViewModel"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      GridLinesVisibility="None"
                      CanUserResizeColumns="True"
                      CanUserSortColumns="True"
                      HeadersVisibility="Column"
                      Background="White"
                      BorderThickness="0">
                
                <DataGrid.Styles>
                    <Style Selector="DataGridColumnHeader">
                        <Setter Property="Background" Value="#f5f5f5"/>
                        <Setter Property="Height" Value="44"/>
                        <Setter Property="BorderBrush" Value="#ddd"/>
                        <Setter Property="BorderThickness" Value="0,0,0,1"/>
                    </Style>
                    <Style Selector="DataGridRow">
                        <Setter Property="MinHeight" Value="46"/>
                        <Setter Property="BorderBrush" Value="#e8e8e8"/>
                        <Setter Property="BorderThickness" Value="0,0,0,1"/>
                    </Style>
                    <Style Selector="DataGridRow:selected">
                        <Setter Property="Background" Value="#e3f2fd"/>
                    </Style>
                    <Style Selector="DataGridCell">
                        <Setter Property="Padding" Value="10,0"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                    </Style>
                </DataGrid.Styles>

                <DataGrid.Columns>
                    <DataGridTextColumn Header="STT" Binding="{Binding Index}" x:DataType="models:CardEventModel" Width="60"/>
                    <DataGridTextColumn Header="Số thẻ" Binding="{Binding CardNumber}" x:DataType="models:CardEventModel" Width="130"/>
                    <DataGridTextColumn Header="Biển số vào" Binding="{Binding PlateIn}" x:DataType="models:CardEventModel" Width="130"/>
                    <DataGridTextColumn Header="Thời gian vào" Binding="{Binding DisplayDatetimeIn}" x:DataType="models:CardEventModel" Width="170"/>
                    <DataGridTextColumn Header="Thời gian ra" Binding="{Binding DisplayDateTimeOut}" x:DataType="models:CardEventModel" Width="170"/>
                    <DataGridTextColumn Header="Tên khách hàng" Binding="{Binding CustomerName}" x:DataType="models:CardEventModel" Width="*"/>
                    <DataGridTextColumn Header="Số tiền" Binding="{Binding DisplayMoneys}" x:DataType="models:CardEventModel" Width="130"/>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>
</UserControl>