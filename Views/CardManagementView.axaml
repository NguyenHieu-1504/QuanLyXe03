<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:QuanLyXe03.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="800"
             x:Class="QuanLyXe03.Views.CardManagementView"
             x:DataType="vm:CardManagementViewModel"
             > <Design.DataContext>
        <vm:CardManagementViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,Auto,Auto,*" Margin="15">
        
        <Grid Grid.Row="0" ColumnDefinitions="2*,1*,1*,1.5*,1.5*" Margin="0,0,0,10">
            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                <TextBlock Text="Từ khóa:" FontSize="13" Margin="0,0,0,5"/>
                <TextBox Text="{Binding SearchText}" 
                         Watermark="Số thẻ, mã thẻ, mã khách hàng"
                         Height="35"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Margin="0,0,10,0">
                <TextBlock Text="Từ ngày:" FontSize="13" Margin="0,0,0,5"/>
                <DatePicker SelectedDate="{Binding FromDate}" Height="35"/>
            </StackPanel>

            <StackPanel Grid.Column="2" Margin="0,0,10,0">
                <TextBlock Text="Đến ngày:" FontSize="13" Margin="0,0,0,5"/>
                <DatePicker SelectedDate="{Binding ToDate}" Height="35"/>
            </StackPanel>

            <StackPanel Grid.Column="3" Margin="0,0,10,0">
                <TextBlock Text="Nhóm khách hàng:" FontSize="13" Margin="0,0,0,5"/>
                <ComboBox Height="35" HorizontalAlignment="Stretch">
                    <ComboBoxItem Content="--Chọn nhóm khách hàng--" IsSelected="True"/>
                </ComboBox>
            </StackPanel>

            <StackPanel Grid.Column="4">
                <TextBlock Text="Trạng thái:" FontSize="13" Margin="0,0,0,5"/>
                <ComboBox Height="35" HorizontalAlignment="Stretch">
                    <ComboBoxItem Content="-- Lựa chọn trạng thái --" IsSelected="True"/>
                    <ComboBoxItem Content="Chưa kích hoạt"/>
                    <ComboBoxItem Content="Đang hoạt động"/>
                    <ComboBoxItem Content="Hết hạn"/>
                    <ComboBoxItem Content="Đã khóa"/>
                </ComboBox>
            </StackPanel>
        </Grid>

        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
            <RadioButton Content="Không lọc theo ngày" 
                         IsChecked="True" 
                         GroupName="DateFilter"
                         Margin="0,0,20,0"
                         Command="{Binding ResetCommand}"/>
            <RadioButton Content="Lọc theo ngày đăng ký" 
                         GroupName="DateFilter"
                         Margin="0,0,20,0"/>
            <RadioButton Content="Lọc theo ngày hết hạn" 
                         GroupName="DateFilter"
                         Margin="0,0,20,0"/>
            
            <TextBlock Text="Nhóm thẻ:" VerticalAlignment="Center" Margin="20,0,10,0"/>
            <ComboBox Width="150">
                <ComboBoxItem Content="None selected" IsSelected="True"/>
            </ComboBox>
        </StackPanel>

        <Grid Grid.Row="2" ColumnDefinitions="Auto,*,Auto" Margin="0,0,0,10">
            
            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="10">
                <Button Content="🔍 Tìm kiếm" 
                         Command="{Binding SearchCommand}"
                        Background="#007bff" 
                        Foreground="White"
                        Padding="15,8"
                         FontSize="13"/>

                <Button Content="➕ Thêm mới" 
                        Click="AddCard_Click"
                        Background="#28a745" 
                        Foreground="White"
                        Padding="15,8"
                        FontSize="13"/>
                
                <Button Content="📄 Xuất excel" 
                         Command="{Binding ExportExcelCommand}"
                        Background="#28a745" 
                        Foreground="White"
                        Padding="15,8"
                         FontSize="13"/>
                
                <Button Content="📥 Nhập excel" 
                        Command="{Binding ImportExcelCommand}"
                        Background="#28a745" 
                        Foreground="White"
                        Padding="15,8"
                        FontSize="13"/>
                
                <Button Content="🔄 Reset" 
                        Command="{Binding ResetCommand}"
                        Background="#6c757d" 
                        Foreground="White"
                         Padding="15,8"
                        FontSize="13"/>
            </StackPanel>

            <StackPanel Grid.Column="1" 
                        Orientation="Horizontal"
                         HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Spacing="10">
                
                <Button Content="&lt; Trước" 
                        Command="{Binding PreviousPageCommand}"
                        Background="#6c757d" 
                        Foreground="White"
                        Padding="12,8"
                        FontSize="13"/>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="5">
                    <TextBlock Text="Trang" Foreground="#333"/>
                    <TextBlock Text="{Binding CurrentPage}" FontWeight="Bold" Foreground="#7da7d1"/>
                    <TextBlock Text="/" Foreground="#666"/>
                    <TextBlock Text="{Binding TotalPages}" FontWeight="Bold" Foreground="#333"/>
                </StackPanel>
                
                <Button Content="Sau &gt;" 
                        Command="{Binding NextPageCommand}"
                        Background="#6c757d" 
                        Foreground="White"
                        Padding="12,8"
                        FontSize="13"/>
                        
                <Border BorderBrush="#ccc" BorderThickness="1,0,0,0" Height="25" Margin="5,0"/>

                <TextBlock Text="{Binding SelectedCount, StringFormat='Đã chọn: {0}'}"
                           FontSize="13" Foreground="#666" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding TotalCount, StringFormat='Tổng: {0}'}"
                           FontSize="13" Foreground="#666" VerticalAlignment="Center"/>
            </StackPanel>

            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="10">
                <Button Content="🔒 Khóa thẻ" 
                         Background="#ffc107" 
                        Foreground="White"
                        Padding="12,8"
                        FontSize="13"/>
                
                <Button Content="🔓 Mở thẻ" 
                        Background="#17a2b8" 
                        Foreground="White"
                        Padding="12,8"
                         FontSize="13"/>
                
                <Button Content="🗑️ Xóa thẻ" 
                        Command="{Binding DeleteCardsCommand}"
                        Background="#dc3545" 
                         Foreground="White"
                        Padding="12,8"
                        FontSize="13"/>
                
                <Button Content="❌ Hủy thẻ" 
                        Background="#6c757d" 
                        Foreground="White"
                        Padding="12,8"
                         FontSize="13"/>
            </StackPanel>
        </Grid>

     <Border Grid.Row="3"
        BorderBrush="#ddd"
        BorderThickness="1"
        CornerRadius="6"
        Background="White"
        BoxShadow="0 4 20 0 #20000000">

    <DataGrid ItemsSource="{Binding Cards}"
              AutoGenerateColumns="False"
              IsReadOnly="True"
              GridLinesVisibility="None"
              CanUserReorderColumns="False"
              CanUserResizeColumns="True"
              CanUserSortColumns="True"
              SelectionMode="Extended"
              HeadersVisibility="Column"
              Background="White"
              BorderThickness="0">

        <!-- Toàn bộ hiệu ứng đẹp bằng Styles (hoạt động 100% từ Avalonia 11.0) -->
        <DataGrid.Styles>
            <!-- Header đẹp -->
            <Style Selector="DataGridColumnHeader">
                <Setter Property="Background" Value="#f5f5f5"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="Foreground" Value="#333"/>
                <Setter Property="Padding" Value="12,10"/>
                <Setter Property="Height" Value="44"/>
                <Setter Property="BorderBrush" Value="#ddd"/>
                <Setter Property="BorderThickness" Value="0,0,0,1"/>
            </Style>

            <!-- Dòng chẵn/lẻ xen kẽ + viền dưới + chiều cao -->
            <Style Selector="DataGridRow">
                <Setter Property="MinHeight" Value="44"/>
                <Setter Property="BorderBrush" Value="#e8e8e8"/>
                <Setter Property="BorderThickness" Value="0,0,0,1"/>
                <Setter Property="Margin" Value="0,0,0,1"/>
                <Setter Property="Background" Value="White"/>
            </Style>

            <!-- Dòng lẻ (alternating) – thay thế cho AlternatingRowBackground -->
            <Style Selector="DataGridRow:nth-child(odd)">
                <Setter Property="Background" Value="#fbfcfc"/>
            </Style>

            <!-- Hover -->
            <Style Selector="DataGridRow:pointerover">
                <Setter Property="Background" Value="#f0f7ff"/>
            </Style>

            <!-- Selected -->
            <Style Selector="DataGridRow:selected">
                <Setter Property="Background" Value="#e3f2fd"/>
                <Setter Property="BorderBrush" Value="#2196F3"/>
                <Setter Property="BorderThickness" Value="0,0,0,2"/>
            </Style>

            <!-- Căn giữa nội dung ô (checkbox, STT…) -->
            <Style Selector="DataGridCell">
                <Setter Property="Padding" Value="8,0"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
            </Style>
        </DataGrid.Styles>

        <!-- Các cột giữ nguyên hoàn toàn -->
        <DataGrid.Columns>
            <DataGridTemplateColumn Header="Check" Width="50">
                <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                        <CheckBox IsChecked="{Binding IsSelected}"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"/>
                    </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

            <DataGridTextColumn Header="STT" Binding="{Binding Index}" Width="50"/>
            <DataGridTextColumn Header="CardNo" Binding="{Binding CardNo}" Width="100"/>
            <DataGridTextColumn Header="Mã thẻ" Binding="{Binding CardNumber}" Width="120"/>
            <DataGridTextColumn Header="Nhóm thẻ" Binding="{Binding CardGroupName}" Width="100"/>
            <DataGridTextColumn Header="Biển số" Binding="{Binding Plate1}" Width="100"/>
            <DataGridTextColumn Header="Ngày hết hạn" Binding="{Binding DisplayExpireDate}" Width="110"/>
            <DataGridTextColumn Header="Mã KH" Binding="{Binding CustomerID}" Width="100"/>
            <DataGridTextColumn Header="Khách hàng" Binding="{Binding CustomerName}" Width="*" MinWidth="130"/>
            <DataGridTextColumn Header="Địa chỉ" Binding="{Binding Address}" Width="150"/>
            <DataGridTextColumn Header="Căn hộ" Binding="{Binding ApartmentNumber}" Width="80"/>
            <DataGridTextColumn Header="Nhóm KH" Binding="{Binding CustomerGroupName}" Width="100"/>
            <DataGridTextColumn Header="Ngày đăng ký" Binding="{Binding DisplayDateRegister}" Width="120"/>
            <DataGridTextColumn Header="Trạng thái" Binding="{Binding StatusText}" Width="120"/>

            <DataGridTemplateColumn Header="Xử lý" Width="180">
                <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" 
                                    Spacing="5" 
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                            <Button Content="Edit" Width="30" Height="30" Padding="0" Background="#ffc107" ToolTip.Tip="Sửa"/>
                            <Button Content="View" Width="30" Height="30" Padding="0" Background="#17a2b8" ToolTip.Tip="Xem"/>
                            <Button Content="Lock" Width="30" Height="30" Padding="0" Background="#6c757d" ToolTip.Tip="Khóa"/>
                            <Button Content="Delete" Width="30" Height="30" Padding="0" Background="#dc3545" ToolTip.Tip="Xóa"/>
                        </StackPanel>
                    </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>
        </DataGrid.Columns>
    </DataGrid>
</Border>
    </Grid>
</UserControl>